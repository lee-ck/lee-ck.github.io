---
layout: single
title:  "Koopman-based MPC"
tags: [TubeMPC, MPC, All]
comments: true
author_profile: false
toc: true
---


## Approximating a Koopman Operator

**Input을 포함하는 시스템의 Koopman Operator**

System : 
$$
x_{t+1} = f(x_t,u_t) 
$$

Koopman opertaor : 
$$
  \mathcal{K}g (x_t) = g(f(x_t,u_t))
$$


Observation functions : 
$$
\Psi(x) : \psi_1 (x), \psi_2 (x), \ldots, \psi_N (x)
$$

Lifted state : 
$$
z_t = [\psi_1 (x_t), \psi_2 (x_t), \ldots, \psi_N (x_t)]^\top
$$


이 함수들로 다음과 같이 $y_k = g(x_k)$를 다시 표현할 수 있음

$$
y_k = \Psi(x_k)
$$

그러면 Koopman operator는 다음의 관계를 가짐

$$
\Psi(x_{k+1}) = K\Psi(x_k) + w
$$

where $K\in \mathbb{C}^{N\times N}$ and w is an error.

{: .notice--info}
제어기 설계할 때 근사화 오차를 고려할 필요가 있음 (Robust Control).


$$
\text{Cost function} : J = \sum^{P-1}_{p=1} || \Psi(x_{p+1}) - K\Psi(x_{p}) ||^2
$$


$P$ : 데이터 개수

$J$를 최소화 하는 $K$ 찾아야함.

Least-square를 사용하는 경우에 다음의 방식으로 간단히 계산가능.

$$
K = G^\dagger A,\\
G = \frac{1}{P} \sum^{P-1}_{p=1} \Psi(x_p)^\top\Psi(x_p) ,\\
A = \frac{1}{P} \sum^{P-1}_{p=1} \Psi(x_p)^\top\Psi(x_{p+1}),
$$

$\Psi$의 차원이 커질수록 계산이 어려움. 하지만 차원이 커야 Koopman operator를 이용한 모델링 성능이 좋아짐. 

&rarr; 차원이 높은, 복잡한 시스템에 적용하기에는 어려움이 있음 (최근 Deep Koopman Operator를 이용한 연구가 활발해진 이유 - DNN를 사용하는 경우, user-defined vector-valued function을 네트워크로 찾을 수 있고 복잡한 최적화 문제를 해결가능).

{: .notice--info}
Koopman modeling 사용해서 제어기 설계하는 연구를 하는 경우에는 굳이 NN를 쓸 필요는 없어보임. 물론 실제 application에 적용할때는 유용할듯.




## References
[1] Yiqiang Han et al., "[Linear predictors for nonlinear dynamical systems: Koopman operator meets model predictive control](https://www.sciencedirect.com/science/article/pii/S000510981830133X)", Automatica 2018 (citation 500&uarr;)

[2] Yiqiang Han et al., "[Deep Learning of Koopman Representation for Control](https://ieeexplore.ieee.org/abstract/document/9304238)", CDC 2020 (citation 40&uarr;)

[3] "[Deep Neural Networks with Koopman Operators for Modeling and Control of Autonomous Vehicles](https://arxiv.org/abs/2007.02219)", IEEE Transactions on Intelligent Vehicles 2022 (citation 10&uarr;)